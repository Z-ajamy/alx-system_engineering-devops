#!/usr/bin/env bash

# Function to fetch and display subdomain information
get_subdomain_info() {
    local domain=$1
    local subdomain=$2
    local fqdn="${subdomain}.${domain}"

    # Use dig to get the record type and destination
    local result=$(dig +short "$fqdn")
    local record_type=$(dig "$fqdn" | grep -A1 'ANSWER SECTION:' | awk '{print $4}')
    local destination=$(dig "$fqdn" | grep -A1 'ANSWER SECTION:' | awk '{print $5}')

    # Check if result is empty
    if [[ -z "$result" ]]; then
        echo "No information available for ${fqdn}"
    else
        echo "The subdomain ${subdomain} is a ${record_type} record and points to ${destination}"
    fi
}

# Main logic
domain=""
subdomain=""

while [[ $# -gt 0 ]]; do
    case $1 in
        domain)
            domain="$2"
            shift 2
            ;;
        subdomain)
            subdomain="$2"
            shift 2
            ;;
        *)
            shift
            ;;
    esac
done

# Validate if domain is provided
if [[ -z "$domain" ]]; then
    echo "Domain parameter is required"
    exit 1
fi

# Display information for specified subdomain or default subdomains
if [[ -z "$subdomain" ]]; then
    for sub in www lb-01 web-01 web-02; do
        get_subdomain_info "$domain" "$sub"
    done
else
    get_subdomain_info "$domain" "$subdomain"
fi
